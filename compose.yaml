
  services:
    dvwa:
      image: vulnerables/web-dvwa
      container_name: vulnerable-container
      restart: unless-stopped
      ports:
        - "8080:80"
      environment:
        - MYSQL_ROOT_PASSWORD=${MYSQL_PASSWORD}
        - MYSQL_DATABASE=${MYSQL_DATABASE} 
        - MYSQL_USER=${MYSQL_USER} 
        - MYSQL_PASSWORD=${MYSQL_DATABASE}
      volumes:
        - "./php.ini:/etc/php/7.0/apache2/php.ini"
      env_file:
        - .env
      depends_on:
        - db

    db:
      image: mysql:8.0.42-bookworm # only work for amd64 arch
      restart: always
      environment:
        - MYSQL_ROOT_PASSWORD=${MYSQL_PASSWORD}
        - MYSQL_USER=${MYSQL_USER}
        - MYSQL_PASSWORD=${MYSQL_PASSWORD}
        - MYSQL_DATABASE=${MYSQL_DATABASE}
      healthcheck:
        test: ["CMD", "mysqladmin", "ping", "-h", "localhost", "-u", "${MYSQL_USER}", "-p${MYSQL_PASSWORD}"]
        interval: 30s
        timeout: 10s
        retries: 3
        start_period: 40s
      env_file:
        - .env

    hacker-service:
      build:
        context: .
        dockerfile: Dockerfile.machine
      container_name: attacker-container
      healthcheck:
        test: ["CMD", "curl", "-f", "http://localhost"]
        interval: 30s
        timeout: 10s
        retries: 3
        start_period: 40s
      volumes:
        - "./txt/common.txt:/common/common.txt"
        - "./txt/rockyou.txt:/common/rockyou.txt"
        - "./txt/directory-list-2.3-medium.txt:/common/directory-list-2.3-medium.txt"


    
